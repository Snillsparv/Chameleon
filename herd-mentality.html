<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Herd Mentality ‚Äì Trekamp</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">

    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#0f172a">

    <style>
        :root {
            --bg-overlay: rgba(15, 23, 42, 0.85);
            --card: rgba(30, 41, 59, 0.8);
            --primary: #818cf8;
            --accent: #f472b6;
            --winner-gold: #fbbf24;
            --text: #f8fafc;
            --glass: rgba(255, 255, 255, 0.05);
        }

        * { box-sizing: border-box; transition: all 0.3s ease; }

        body {
            font-family: 'Outfit', sans-serif;
            background-color: #0f172a;
            background-image: linear-gradient(var(--bg-overlay), var(--bg-overlay)), url('background2.png');
            background-size: cover;
            background-position: center center;
            background-attachment: fixed;
            color: var(--text);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        }

        .container {
            width: 95%;
            max-width: 500px;
            background: var(--card);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            padding: 40px 30px;
            border-radius: 32px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            text-align: center;
            opacity: 0;
            animation: startFadeIn 1s ease-out forwards;
            animation-delay: 0.3s;
        }

        @keyframes startFadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .neon-cow {
            width: 130px; height: auto; margin: 0 auto 20px; display: block;
            color: var(--accent); filter: drop-shadow(0 0 15px var(--accent));
        }

        h1 { font-weight: 800; font-size: 2.5rem; margin: 0 0 10px; background: linear-gradient(to right, var(--primary), var(--accent)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        p { color: #94a3b8; margin-bottom: 25px; }

        .btn {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white; border: none; padding: 18px; border-radius: 18px;
            font-weight: 700; cursor: pointer; width: 100%; font-size: 1.1rem;
            margin-top: 15px; box-shadow: 0 10px 20px -5px rgba(129, 140, 248, 0.5);
            font-family: 'Outfit', sans-serif;
        }
        .btn:active { transform: scale(0.98); }

        .question-box {
            background: rgba(15, 23, 42, 0.6); padding: 35px 25px; border-radius: 24px;
            border: 2px solid var(--primary); font-size: 1.6rem; font-weight: 700;
            margin: 25px 0; color: white; line-height: 1.3;
        }

        /* Scoring rows with faces */
        .score-row {
            display: flex; align-items: center;
            background: rgba(255,255,255,0.05); padding: 12px;
            border-radius: 18px; margin-bottom: 10px;
            border: 2px solid transparent; gap: 10px;
        }
        .score-row.has-cow {
            border-color: var(--accent);
            background: rgba(244, 114, 182, 0.15);
        }

        .score-row .sr-face {
            width: 44px; height: 44px; border-radius: 50%; object-fit: cover;
            flex-shrink: 0; transition: all 0.4s ease;
        }

        .score-row .sr-face.cow-face {
            border: 2px solid var(--accent);
            box-shadow: 0 0 12px rgba(244, 114, 182, 0.5);
        }

        .score-row .sr-face.happy { animation: happyBounce 0.5s ease; }
        @keyframes happyBounce { 0% { transform: scale(1); } 40% { transform: scale(1.2); } 100% { transform: scale(1); } }

        .score-row .sr-name { flex: 1; text-align: left; font-weight: 600; }
        .score-row .sr-pts { font-weight: 800; color: var(--primary); min-width: 40px; text-align: right; margin-right: 8px; }

        .cow-btn { background: #1e293b; border: none; padding: 10px; border-radius: 12px; cursor: pointer; font-size: 1.4rem; width: 50px; flex-shrink: 0; }
        .cow-btn.active { background: var(--accent); box-shadow: 0 0 15px var(--accent); }

        .point-btn {
            background: var(--primary); border: none; color: white;
            width: 50px; height: 50px; border-radius: 14px;
            font-weight: 800; cursor: pointer; flex-shrink: 0;
            font-family: 'Outfit', sans-serif;
        }
        .point-btn:disabled { opacity: 0.3; cursor: not-allowed; }

        .video-wrapper { width: 100%; border-radius: 24px; overflow: hidden; border: 2px solid var(--accent); margin-bottom: 20px; background: #000; }
        video { width: 100%; display: block; }

        /* Winner */
        .winner-face {
            width: 110px; height: 110px; border-radius: 50%; object-fit: cover;
            border: 4px solid var(--winner-gold);
            box-shadow: 0 0 25px rgba(251,191,36,0.5);
            margin: 10px auto; display: block;
            animation: winBounce 1.5s ease-in-out infinite;
        }
        @keyframes winBounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

        .final-row {
            display: flex; align-items: center; gap: 10px;
            background: rgba(255,255,255,0.04); padding: 10px 14px; border-radius: 14px; margin-bottom: 8px;
        }
        .final-row .f-face { width: 36px; height: 36px; border-radius: 50%; object-fit: cover; }
        .final-row .f-name { flex: 1; text-align: left; font-weight: 600; }
        .final-row .f-score { font-weight: 800; color: var(--primary); }

        .hidden { display: none !important; }
        .screen-animate { animation: fadeIn 0.4s forwards ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* Confetti */
        .confetti-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1000; overflow: hidden; }
        .confetti { position: absolute; width: 10px; height: 10px; top: -10px; animation: confettiFall linear forwards; }
        @keyframes confettiFall { 0% { transform: translateY(0) rotate(0deg); opacity: 1; } 100% { transform: translateY(100vh) rotate(720deg); opacity: 0; } }
    </style>
</head>
<body>

<div class="container" id="app">

    <div id="scr-question" class="screen-animate">
        <svg class="neon-cow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 2c-4 0-7 3-7 7 0 1.5.5 3 1 4.5C4.5 15 3 16.5 3 18c0 1.5 1 3 2.5 3.5C7 22.5 9.5 23 12 23s5-0.5 6.5-1.5c1.5-0.5 2.5-2 2.5-3.5 0-1.5-1.5-3-3-4.5.5-1.5 1-3 1-4.5C19 5 16 2 12 2z"/>
            <path d="M8 10h.01"/><path d="M16 10h.01"/><path d="M12 16v-2"/>
        </svg>
        <h1>Herd Mentality</h1>
        <p>T√§nk som flocken. Undvik att bli den rosa kon!</p>
        <p id="roundTitle" style="font-weight: 800; color: var(--primary); margin-bottom: 10px;">RUNDA 1</p>
        <div class="question-box" id="qDisplay">...</div>
        <button class="btn" onclick="showScoring()">R√§tta</button>
    </div>

    <div id="scr-scoring" class="hidden screen-animate">
        <h1>Po√§ngs√§ttning</h1>
        <p>Ge po√§ng till majoriteten. Markera vem som √§r <b>Rosa Kon</b> üêÆ</p>
        <div id="scoring-list"></div>
        <div style="display: flex; gap: 10px; margin-top: 20px;">
            <button class="btn" style="flex: 1; background: var(--glass);" onclick="triggerFinal()">Avsluta</button>
            <button class="btn" style="flex: 2; margin-top: 0;" onclick="nextRound()">N√§sta runda</button>
        </div>
    </div>

    <div id="scr-video" class="hidden screen-animate">
        <h1>Finalen...</h1>
        <div class="video-wrapper">
            <video id="victoryVideo" playsinline><source src="video2.mp4" type="video/mp4"></video>
        </div>
        <button class="btn" onclick="finishVideo()">Hoppa √∂ver</button>
    </div>

    <div id="scr-final" class="hidden screen-animate">
        <span style="font-size: 4rem; display: block; animation: winBounce 1.5s ease-in-out infinite;">üëë</span>
        <img id="winnerFace" class="winner-face" src="" alt="Vinnare">
        <h1 id="grandWinner" style="font-size: 3rem; color: var(--winner-gold); -webkit-text-fill-color: var(--winner-gold);">Namn</h1>
        <div id="final-ranking" style="margin-top: 20px;"></div>
        <button class="btn" onclick="saveAndReturn()">Tillbaka till trekampen</button>
    </div>
</div>

<div class="confetti-container" id="confettiContainer"></div>

<script>
    const PLAYERS = [
        { name: 'Jonas', img: 'Jonas' },
        { name: 'Jessica', img: 'Jessan' },
        { name: 'Johanna', img: 'Johanna' },
        { name: 'Alex', img: 'Alex' },
        { name: 'Rasmus', img: 'Rasmus' },
        { name: 'Boel', img: 'Boel' },
        { name: 'Karla', img: 'Karla' },
        { name: 'Elin', img: 'Elin' }
    ];

    function getImg(p, mood) {
        return 'Chameleon Lillebror/' + mood + ' ' + p.img + '.webp';
    }

    const questions = [
        "B√§sta pizzan?", "Mest irriterande instrument?", "B√§sta superkraften?", "Coolaste djuret?",
        "B√§sta frukten?", "B√§sta veckodagen?", "En k√§nd trollkarl?", "B√§sta glassen?",
        "Land med b√§st mat?", "En popul√§r sport?", "B√§sta filmgenren?", "Vanligt hundnamn?",
        "B√§sta s√§ttet att resa?", "N√•got i badrummet?", "B√§sta chokladen?", "En popul√§r app?",
        "B√§sta frukosten?", "Ett tr√•kigt skol√§mne?", "B√§sta br√§dspelet?", "En planet?",
        "B√§sta l√§sken?", "K√§ndis alla gillar?", "B√§sta Disneyfilmen?", "G√∂rs innan man sover?",
        "B√§sta h√∂gtiden?", "Sv√•rskalad frukt?", "B√§sta uppfinningen?", "Stad man vill bes√∂ka?",
        "B√§sta burgaren?", "Roligt men sv√•rt jobb?", "B√§sta kakan?", "Vanlig krydda?",
        "B√§sta s√∂ndagssysslan?", "Ett legendariskt v√§sen?", "B√§sta bilf√§rgen?",
        "Gr√∂nsak barn hatar?", "B√§sta 80-talsl√•ten?", "N√•got man alltid tappar bort?",
        "Anledning att komma sent?", "B√§sta br√∂det?", "G√∂rs n√§r man har tr√•kigt?",
        "B√§sta pommes fritesen?", "B√§sta tecknade serien?", "N√•got man g√∂r p√• br√∂llop?",
        "B√§sta n√∂ten?", "Ett vackert spr√•k?", "B√§sta telefonen?", "N√•got till stranden?",
        "B√§sta pastan?", "En k√§nd idrottare?", "B√§sta sitcomen?", "Kan inte leva utan?", "B√§sta t√•rtan?"
    ];

    let players = PLAYERS.map(p => ({ ...p, score: 0 }));
    let roundNum = 0;
    let shuffledQ = [...questions].sort(() => Math.random() - 0.5);
    let pinkCowIndex = -1;
    let awardedThisRound = {};

    // Start first round immediately
    startRound();

    function startRound() {
        roundNum++;
        document.getElementById('roundTitle').innerText = 'RUNDA ' + roundNum;
        document.getElementById('qDisplay').innerText = shuffledQ[(roundNum - 1) % shuffledQ.length];
        awardedThisRound = {};
        switchScreen(activeScreen(), 'scr-question');
    }

    function showScoring() {
        renderScoringList();
        switchScreen('scr-question', 'scr-scoring');
    }

    function renderScoringList() {
        const list = document.getElementById('scoring-list');
        list.innerHTML = '';
        players.forEach((p, i) => {
            const hasCow = (i === pinkCowIndex);
            const awarded = awardedThisRound[i];
            let mood = 'Rund';
            if (hasCow) mood = 'Ledsen';
            else if (awarded) mood = 'Glad';

            const faceClass = 'sr-face' + (hasCow ? ' cow-face' : '') + (awarded ? ' happy' : '');

            list.innerHTML +=
                '<div class="score-row ' + (hasCow ? 'has-cow' : '') + '">' +
                '<button class="cow-btn ' + (hasCow ? 'active' : '') + '" onclick="toggleCow(' + i + ')">üêÆ</button>' +
                '<img class="' + faceClass + '" src="' + getImg(p, mood) + '" alt="' + p.name + '">' +
                '<span class="sr-name">' + p.name + '</span>' +
                '<span class="sr-pts">' + p.score + ' p</span>' +
                '<button class="point-btn" id="ptBtn' + i + '" ' + (hasCow || awarded ? 'disabled' : '') +
                ' onclick="awardPoint(' + i + ')">+1</button>' +
                '</div>';
        });
    }

    function awardPoint(idx) {
        players[idx].score++;
        awardedThisRound[idx] = true;
        renderScoringList();
    }

    function toggleCow(idx) {
        pinkCowIndex = (pinkCowIndex === idx) ? -1 : idx;
        renderScoringList();
    }

    function nextRound() {
        startRound();
    }

    function triggerFinal() {
        switchScreen('scr-scoring', 'scr-video');
        const v = document.getElementById('victoryVideo');
        v.play().catch(() => { finishVideo(); });
        v.onended = finishVideo;
    }

    function finishVideo() {
        document.getElementById('victoryVideo').pause();
        switchScreen('scr-video', 'scr-final');
        showFinalWinner();
    }

    function showFinalWinner() {
        const sorted = [...players].sort((a, b) => b.score - a.score);
        const winner = sorted[0];

        document.getElementById('winnerFace').src = getImg(winner, 'Glad');
        document.getElementById('grandWinner').innerText = winner.name;

        const ranking = document.getElementById('final-ranking');
        ranking.innerHTML = '<h3 style="color:var(--primary); margin-bottom: 12px;">Slutst√§llning:</h3>';
        sorted.forEach((p, i) => {
            const mood = i === 0 ? 'Glad' : (i >= sorted.length - 2 ? 'Ledsen' : 'Rund');
            ranking.innerHTML += '<div class="final-row">' +
                '<img class="f-face" src="' + getImg(p, mood) + '" alt="' + p.name + '">' +
                '<span class="f-name">' + (i + 1) + '. ' + p.name + '</span>' +
                '<span class="f-score">' + p.score + ' p</span></div>';
        });

        launchConfetti();
    }

    function saveAndReturn() {
        try {
            const scores = JSON.parse(localStorage.getItem('trekamp_scores') || '{}');
            players.forEach(p => { scores[p.name] = (scores[p.name] || 0) + p.score; });
            localStorage.setItem('trekamp_scores', JSON.stringify(scores));

            const games = JSON.parse(localStorage.getItem('trekamp_games') || '[]');
            if (!games.includes('herd-mentality')) games.push('herd-mentality');
            localStorage.setItem('trekamp_games', JSON.stringify(games));
        } catch(e) {}

        window.location.href = 'index.html';
    }

    function switchScreen(from, to) {
        document.getElementById(from).classList.add('hidden');
        const next = document.getElementById(to);
        next.classList.remove('hidden');
        next.classList.remove('screen-animate');
        void next.offsetWidth;
        next.classList.add('screen-animate');
    }

    function activeScreen() {
        const ids = ['scr-question', 'scr-scoring', 'scr-video', 'scr-final'];
        for (let id of ids) if (!document.getElementById(id).classList.contains('hidden')) return id;
        return 'scr-question';
    }

    function launchConfetti() {
        const container = document.getElementById('confettiContainer');
        const colors = ['#818cf8', '#f472b6', '#fbbf24', '#34d399', '#d946ef', '#38bdf8'];
        for (let i = 0; i < 60; i++) {
            const el = document.createElement('div');
            el.className = 'confetti';
            el.style.left = Math.random() * 100 + '%';
            el.style.background = colors[Math.floor(Math.random() * colors.length)];
            el.style.width = (6 + Math.random() * 8) + 'px';
            el.style.height = (6 + Math.random() * 8) + 'px';
            el.style.borderRadius = Math.random() > 0.5 ? '50%' : '2px';
            el.style.animationDuration = (2 + Math.random() * 3) + 's';
            el.style.animationDelay = (Math.random() * 2) + 's';
            container.appendChild(el);
        }
        setTimeout(() => { container.innerHTML = ''; }, 6000);
    }
</script>
</body>
</html>
