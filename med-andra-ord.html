<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Med andra ord</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">

    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#0f172a">

    <style>
        :root {
            --bg-overlay: rgba(15, 23, 42, 0.85);
            --card: rgba(30, 41, 59, 0.8);
            --primary: #818cf8;
            --accent: #34d399;
            --winner-gold: #fbbf24;
            --text: #f8fafc;
            --glass: rgba(255, 255, 255, 0.05);
            --danger: #f87171;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Outfit', sans-serif;
            background-color: #0f172a;
            background-image: linear-gradient(var(--bg-overlay), var(--bg-overlay)), url('background2.png');
            background-size: cover;
            background-position: center center;
            background-attachment: fixed;
            color: var(--text);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            width: 95%;
            max-width: 500px;
            background: var(--card);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            padding: 40px 30px;
            border-radius: 32px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            text-align: center;
            opacity: 0;
            animation: startFadeIn 1.5s ease-out forwards;
            animation-delay: 0.5s;
        }

        @keyframes startFadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h1 { font-weight: 800; font-size: 2.5rem; margin: 0 0 10px; background: linear-gradient(to right, var(--primary), var(--accent)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        p { color: #94a3b8; margin-bottom: 25px; }

        .btn {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white; border: none; padding: 18px; border-radius: 18px;
            font-weight: 700; cursor: pointer; width: 100%; font-size: 1.1rem;
            margin-top: 15px; box-shadow: 0 10px 20px -5px rgba(129, 140, 248, 0.4);
            transition: all 0.3s ease;
            font-family: 'Outfit', sans-serif;
        }
        .btn:active { transform: scale(0.98); }

        .btn-secondary { background: var(--glass); border: 1px solid rgba(255,255,255,0.15); box-shadow: none; }

        input { background: rgba(15, 23, 42, 0.8); border: 1px solid #334155; color: white; padding: 16px; border-radius: 14px; width: 100%; text-align: center; font-size: 1.2rem; margin-top: 10px; font-family: 'Outfit', sans-serif; transition: border-color 0.3s; }
        input:focus { outline: none; border-color: var(--primary); }

        .word-display {
            background: rgba(15, 23, 42, 0.6);
            padding: 40px 25px;
            border-radius: 24px;
            border: 2px solid var(--accent);
            font-size: 2.2rem;
            font-weight: 800;
            margin: 25px 0;
            color: white;
            line-height: 1.3;
            min-height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            user-select: none;
        }

        /* Timer */
        .timer-container { margin: 20px 0; position: relative; }
        .timer-bar-bg {
            width: 100%;
            height: 12px;
            background: rgba(255,255,255,0.1);
            border-radius: 6px;
            overflow: hidden;
        }
        .timer-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), var(--primary));
            border-radius: 6px;
            transition: width 0.1s linear;
            width: 100%;
        }
        .timer-bar.warning { background: linear-gradient(90deg, var(--danger), #fbbf24); }
        .timer-text { font-size: 2rem; font-weight: 800; margin-bottom: 8px; color: var(--accent); }
        .timer-text.warning { color: var(--danger); }

        /* Score tracking */
        .score-row {
            display: flex; justify-content: space-between; align-items: center;
            background: rgba(255,255,255,0.05); padding: 15px; border-radius: 18px;
            margin-bottom: 12px; transition: all 0.3s;
        }
        .score-row .player-name { flex: 1; text-align: left; margin-left: 10px; font-weight: 600; }
        .score-row .player-score { font-weight: 800; color: var(--accent); font-size: 1.1rem; min-width: 50px; text-align: right; }

        .point-btn {
            background: var(--primary); border: none; color: white;
            width: 44px; height: 44px; border-radius: 12px; font-weight: 800;
            cursor: pointer; font-size: 1rem; transition: all 0.2s;
            font-family: 'Outfit', sans-serif;
        }
        .point-btn:active { transform: scale(0.9); }
        .minus-btn { background: rgba(248, 113, 113, 0.3); color: var(--danger); }

        /* Round controls */
        .round-controls { display: flex; gap: 12px; margin-top: 15px; }
        .round-controls .btn { flex: 1; margin-top: 0; }

        /* Team setup */
        .team-block {
            background: rgba(255,255,255,0.05); border-radius: 18px;
            padding: 20px; margin-bottom: 15px; border: 1px solid rgba(255,255,255,0.1);
        }
        .team-block h3 { font-size: 1.1rem; margin-bottom: 10px; color: var(--accent); }
        .team-block.team-b h3 { color: var(--primary); }

        .team-indicator {
            display: inline-block;
            padding: 6px 16px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 0.9rem;
            margin-bottom: 15px;
        }
        .team-a-badge { background: rgba(52, 211, 153, 0.2); color: var(--accent); }
        .team-b-badge { background: rgba(129, 140, 248, 0.2); color: var(--primary); }

        /* Player input */
        .player-input-row {
            display: flex; gap: 8px; align-items: center; margin-top: 8px;
        }
        .player-input-row input { flex: 1; margin: 0; }
        .player-input-row .remove-btn {
            background: rgba(248,113,113,0.2); border: 1px solid rgba(248,113,113,0.3);
            color: var(--danger); width: 42px; height: 42px; border-radius: 12px;
            cursor: pointer; font-size: 1.2rem; font-weight: 700; flex-shrink: 0;
            font-family: 'Outfit', sans-serif;
        }
        .player-list { margin: 10px 0; }
        .team-count-row {
            display: flex; align-items: center; justify-content: center; gap: 15px;
            margin: 15px 0;
        }
        .team-count-row button {
            background: var(--glass); border: 1px solid rgba(255,255,255,0.2);
            color: white; width: 44px; height: 44px; border-radius: 12px;
            font-size: 1.3rem; font-weight: 800; cursor: pointer;
            font-family: 'Outfit', sans-serif;
        }
        .team-count-row button:active { transform: scale(0.9); }
        .team-count-display { font-size: 2rem; font-weight: 800; min-width: 40px; }

        /* Team assignment display */
        .team-assignment {
            background: rgba(255,255,255,0.05); border-radius: 18px;
            padding: 15px; margin-bottom: 12px; border: 1px solid rgba(255,255,255,0.1);
        }
        .team-assignment h3 { font-size: 1rem; margin-bottom: 8px; }
        .team-assignment .member { padding: 4px 0; color: #cbd5e1; font-size: 0.95rem; }

        .validation-error { color: var(--danger); font-size: 0.85rem; margin-top: 8px; display: none; }

        .word-counter { color: #64748b; font-size: 0.85rem; margin-top: 5px; }

        /* Victory */
        .winner-crown { font-size: 4rem; margin-bottom: 10px; animation: bounce 1s infinite; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

        .hidden { display: none !important; }
        .screen-animate { animation: fadeIn 0.4s forwards ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        .rules-box {
            background: rgba(15, 23, 42, 0.6);
            border-radius: 18px;
            padding: 20px;
            text-align: left;
            margin: 15px 0;
            border: 1px solid rgba(255,255,255,0.1);
            color: #cbd5e1;
            font-size: 0.9rem;
            line-height: 1.6;
        }
        .rules-box b { color: var(--text); }

        .settings-row {
            display: flex; align-items: center; justify-content: space-between;
            background: rgba(255,255,255,0.05); padding: 14px 18px;
            border-radius: 14px; margin-top: 10px;
        }
        .settings-row label { font-weight: 600; font-size: 0.95rem; }
        .settings-row input { width: 80px; margin: 0; padding: 10px; font-size: 1rem; }

        .team-score-display {
            display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;
        }
        .team-score-card {
            flex: 1 1 calc(50% - 10px); min-width: 80px; padding: 12px 8px; border-radius: 18px; text-align: center;
        }
        .team-score-card .team-label { font-size: 0.8rem; color: #94a3b8; margin-bottom: 4px; }
        .team-score-card .team-pts { font-size: 1.8rem; font-weight: 800; }
    </style>
</head>
<body>

<div class="container" id="app">

    <!-- STARTSK√ÑRM -->
    <div id="scr-start" class="screen-animate">
        <div style="font-size: 3.5rem; margin-bottom: 15px;">üí¨</div>
        <h1>Med andra ord</h1>
        <p>F√∂rklara ord f√∂r ditt lag utan att s√§ga sj√§lva ordet!</p>
        <div class="rules-box">
            <b>S√• spelar ni:</b><br>
            1. Skriv in alla spelares namn och v√§lj antal lag<br>
            2. Spelare slumpas in i lagen<br>
            3. En spelare f√∂rklarar ord medan laget gissar<br>
            4. Du f√•r INTE s√§ga ordet eller delar av det<br>
            5. R√§tt gissat = +1 po√§ng, hoppa √∂ver = -1 po√§ng<br>
            6. Laget med flest po√§ng vinner!
        </div>
        <button class="btn" onclick="switchScreen('scr-start','scr-setup')">S√§tt ig√•ng!</button>
        <a href="index.html" style="display:inline-block; margin-top:15px; color:#818cf8; font-size:0.9rem; text-decoration:none;">&#8592; Tillbaka till meny</a>
    </div>

    <!-- INST√ÑLLNINGAR -->
    <div id="scr-setup" class="hidden screen-animate">
        <h1>Inst√§llningar</h1>
        <p>St√§ll in spelet</p>
        <div class="settings-row">
            <label>Sekunder per runda:</label>
            <input type="number" id="timerInput" value="60" min="20" max="120" step="10">
        </div>
        <div class="settings-row">
            <label>Po√§ng f√∂r att vinna:</label>
            <input type="number" id="winScoreInput" value="25" min="5" max="100" step="5">
        </div>
        <button class="btn" onclick="switchScreen('scr-setup','scr-players')">Forts√§tt</button>
    </div>

    <!-- SPELARE & ANTAL LAG -->
    <div id="scr-players" class="hidden screen-animate">
        <h1>Spelare</h1>
        <p>L√§gg till alla som ska spela</p>
        <div id="playerInputs" class="player-list"></div>
        <button class="btn btn-secondary" onclick="addPlayerInput()" style="margin-top: 10px;">+ L√§gg till spelare</button>
        <div style="margin-top: 20px;">
            <label style="font-weight: 600; font-size: 1.05rem;">Antal lag:</label>
            <div class="team-count-row">
                <button onclick="changeTeamCount(-1)">‚àí</button>
                <div class="team-count-display" id="teamCountDisplay">2</div>
                <button onclick="changeTeamCount(1)">+</button>
            </div>
        </div>
        <div class="validation-error" id="playerError">Varje lag beh√∂ver minst 2 spelare.</div>
        <button class="btn" onclick="assignTeams()">Slumpa lag!</button>
    </div>

    <!-- LAGVISNING / NAMNGE LAG -->
    <div id="scr-teams" class="hidden screen-animate">
        <h1>Lagen</h1>
        <p>S√• h√§r slumpades lagen! Ge dem namn om ni vill.</p>
        <div id="teamAssignments"></div>
        <button class="btn" onclick="startGame()">Starta spelet!</button>
    </div>

    <!-- VEM F√ñRKLARAR -->
    <div id="scr-turn" class="hidden screen-animate">
        <div class="team-score-display" id="turnScores"></div>
        <div id="turnTeamBadge" class="team-indicator" style="margin-bottom: 10px;">Lag</div>
        <h1 style="font-size: 1.8rem; margin-bottom: 5px;">Er tur att f√∂rklara!</h1>
        <p>Ge telefonen till den som ska f√∂rklara</p>
        <button class="btn" onclick="startTimer()">Starta rundan!</button>
    </div>

    <!-- SPELRUNDA (timer + ord) -->
    <div id="scr-play" class="hidden screen-animate">
        <div class="timer-container">
            <div class="timer-text" id="timerText">60</div>
            <div class="timer-bar-bg"><div class="timer-bar" id="timerBar"></div></div>
        </div>
        <div class="word-display" id="wordDisplay">‚Äî</div>
        <div class="word-counter" id="wordCounter">Ord 1</div>
        <div class="round-controls">
            <button class="btn btn-secondary" onclick="skipWord()" id="btnSkip" style="background: rgba(248,113,113,0.2); border-color: rgba(248,113,113,0.4); color: var(--danger);">Hoppa √∂ver (-1)</button>
            <button class="btn" onclick="correctWord()">R√§tt! (+1)</button>
        </div>
    </div>

    <!-- RUNDRESULTAT -->
    <div id="scr-result" class="hidden screen-animate">
        <h1 style="font-size: 1.8rem;">Rundan slut!</h1>
        <div class="team-score-display" id="resScores" style="margin-top: 20px;"></div>
        <p id="resultSummary" style="font-size: 1.1rem; color: var(--text);"></p>
        <div id="resultWords" style="margin: 15px 0; text-align: left;"></div>
        <button class="btn" id="btnNextRound" onclick="nextTurn()">N√§sta lag</button>
    </div>

    <!-- VINNARE -->
    <div id="scr-final" class="hidden screen-animate">
        <div class="winner-crown">üëë</div>
        <h1 id="winnerName" style="font-size: 2.5rem; color: var(--winner-gold); -webkit-text-fill-color: var(--winner-gold);">Vinnare!</h1>
        <p id="winnerSub" style="font-size: 1.1rem;">vinner med 25 po√§ng!</p>
        <div class="team-score-display" id="finalScores" style="margin-top: 20px;"></div>
        <button class="btn" onclick="location.reload()">Spela igen</button>
        <a href="index.html" style="display:inline-block; margin-top:15px; color:#818cf8; font-size:0.9rem; text-decoration:none;">&#8592; Tillbaka till meny</a>
    </div>
</div>

<script>
    /* ============================================================
       ORDDATABAS ‚Äî ca 415 ord
       Mix: substantiv, verb, adjektiv, abstrakta substantiv,
            avancerade ord, k√§nda personer & karakt√§rer
       ============================================================ */
    const allWords = [
        // ‚Äî VARDAGLIGA SUBSTANTIV (ca 120 st) ‚Äî
        "Tandborste","Flygplan","Jordgubbe","Solglas√∂gon","Regnb√•ge",
        "Fotboll","Dammsugare","Skorsten","H√§ngmatta","Fallsk√§rm",
        "Segelb√•t","Karusell","Glasspinne","Brevl√•da","Trumma",
        "Popcorn","Pyramid","Dagbok","Cykel","Studsare",
        "Strykj√§rn","Ambulans","Kikare","Ryggs√§ck","Solros",
        "Ficklampa","Helikopter","Vulkan","Skateboard","Gardin",
        "Diskmaskin","St√∂vlar","Paraply","Bergochdalbana","Kompass",
        "Akvarium","Saxofon","H√∂rlurar","Kamera","Sm√∂rg√•s",
        "Badkar","Vindkraftverk","Skottk√§rra","Dykare","Smink",
        "Grillkorv","Studentm√∂ssa","Dockhus","Trampolin","Palmtr√§d",
        "T√§lt","Ballong","Gungstol","Tennisracket","Roddb√•t",
        "Sn√∂gubbe","Spindeln√§t","Eldslukare","F√•gelskr√§mma","Flaskhals",
        "Korsord","Sandslott","Fiskm√•s","Vattenpistol","Myra",
        "Pingvin","K√§nguru","Delfin","Uggla","Papegoja",
        "Elefant","Krokodil","Sk√∂ldpadda","Giraff","Flodh√§st",
        "Astronaut","Brandman","Sjuksk√∂terska","Bagare","Fris√∂r",
        "Pilot","Clown","Detektiv","Cowboy","Trollkarl",
        "Pannkaka","Kanelbulle","K√∂ttbullar","Varmkorv","Chokladkaka",
        "Kaffekopp","Potatisskalare","Br√∂drost","Tv√§ttmaskin","Kylsk√•p",
        "Fyrtorn","Igloo","Slott","Vindm√∂lla","Font√§n",
        "Rulltrappa","Bilbarnstol","Dr√∂nare","S√•pbubbla","Torktumlare",
        "Vattenfall","Laviner","Gl√∂dlampa","Diamant","Skattkista",
        "Sk√§ggig","Hammock","Nyckelring","Kuvert","Pappersflygplan",
        "Mustasch","Peruk","Megafon","Rullstol","Gosedjur",

        // ‚Äî VERB (ca 60 st) ‚Äî
        "Skratta","Simma","Jonglera","Vissla","Snickra",
        "G√§spa","Nosa","Kl√§ttra","Brottas","Dansa",
        "Dr√∂mma","Snubbla","Krypa","Grilla","Hosta",
        "Jogga","Steka","H√§nga","Blunda","Smyga",
        "Snarka","Paddla","Segla","Dyka","Surfa",
        "Hoppa","Nicka","Blinka","Sjunga","Sova",
        "M√•la","Gr√•ta","Sl√•ss","Vindsurfa","Baka",
        "Meditera","Dirigera","Limma","T√§vla","Flyga",
        "Ramla","Klia","Nyna","Sparka","Rapa",
        "Snurra","Trolla","Buga","Flirta","Jogga",
        "Stretcha","Pussla","Skala","Fiska","Jaga",
        "Springa","Hoppsa","Virka","T√§lta","Skida",

        // ‚Äî ADJEKTIV (ca 45 st) ‚Äî
        "Modig","Avundsjuk","Generad","Envis","Mystisk",
        "Klurig","Sl√∂","Nyfiken","Blyg","Girig",
        "Listig","Butter","H√§ftig","Klumpig","Lat",
        "R√§dd","Stolt","F√∂rvirrad","Desperat","L√∂jlig",
        "√ñdmjuk","Artig","Elak","Vresig","F√•f√§ng",
        "Paranoid","Romantisk","Nostalgisk","Spontan","Lycklig",
        "Besviken","F√∂r√§lskad","Hungrig","T√∂rstig","Tr√∂tt",
        "Kittlig","Frusen","Svettig","Yr","M√§tt",
        "Gener√∂s","Makaber","Dramatisk","Sarkastisk","Osynlig",

        // ‚Äî ABSTRAKTA SUBSTANTIV (ca 45 st) ‚Äî
        "Nostalgi","Frihet","Fantasi","R√§ttvisa","V√§nskap",
        "Karma","Kaos","Instinkt","Tradition","Kreativitet",
        "Skam","Stolthet","Empati","Mod","Galenskap",
        "Tur","√ñde","Samvete","K√§rlek","Avund",
        "Makt","Hopp","√Öngest","Gl√§dje","Sorg",
        "Ilska","Respekt","Lojalitet","F√∂rtroende","Heml√§ngtan",
        "√Ñventyr","F√∂rdomar","Ensamhet","Panik","L√§ngtan",
        "Inspiration","Harmoni","Karisma","Uppfinning","Disciplin",
        "Prestige","Ironi","Dilemma","Utmaning","T√•lamod",

        // ‚Äî SV√ÖRARE / MER AVANCERADE ORD (ca 60 st) ‚Äî
        "Byr√•krati","Demokrati","Paradox","Filosofi","Propaganda",
        "Diplomati","Kompromiss","Korruption","Revolution","Civilisation",
        "Perspektiv","Prejudikat","Filantropi","Melankoli","Eufori",
        "Skepticism","Sarkasm","Metafor","Symbolik","Dubbeltydig",
        "Trov√§rdighet","Sj√§lvf√∂rtroende","Konsekvens","Integritet","Sj√§lvbedr√§geri",
        "Procrastinera","F√∂rneka","Normalisera","Manipulera","Imponera",
        "Antyda","Provocera","Kompensera","Bl√§ndas","√ñvertyga",
        "√ñverskatta","Underskatta","Relatera","Resonera","Ifr√•gas√§tta",
        "Hyckleri","Dubbelmoral","Stereotyp","F√∂rdom","Syndabock",
        "Identitetskris","Grupptryck","Pliktskyldig","M√•ngsidighet","Tunnelseende",
        "Storhetsvansinne","Bekr√§ftelsebehov","√ñnsket√§nkande","Skadegl√§dje","Rampfeber",

        // ‚Äî K√ÑNDA PERSONER & KARAKT√ÑRER (ca 60 st) ‚Äî
        "Pippi L√•ngstrump","Einstein","Kleopatra","Bamse","Zlatan",
        "Harry Potter","Batman","Tarzan","Musse Pigg","R√∂dluvan",
        "Elvis","Madonna","Mona Lisa","Astrid Lindgren","Robin Hood",
        "Donald Duck","Sherlock Holmes","Mozart","Napoleon","ABBA",
        "Karlsson p√• taket","Ronja R√∂vardotter","Emil i L√∂nneberga","Nalle Puh","Pinocchio",
        "Dracula","Sn√∂vit","Askungen","Zorro","Greta Thunberg",
        "Beyonc√©","Elon Musk","Frida Kahlo","Leonardo da Vinci","Mahatma Gandhi",
        "Martin Luther King","Marilyn Monroe","Charlie Chaplin","Michael Jackson","Oprah Winfrey",
        "Shrek","Elsa fr√•n Frost","Yoda","James Bond","Indiana Jones",
        "Lara Croft","Mario","SpongeBob","Simba","Buzz Lightyear",
        "Hermione Granger","Gandalf","Darth Vader","Spider-Man","Wonder Woman",
        "Kalle Anka","Lotta p√• Br√•kmakargatan","Alfons √Öberg","Pettson och Findus","Mumin"
    ];

    /* ============================================================
       SPELLOGIK
       ============================================================ */
    const teamColors = [
        { bg: 'rgba(52, 211, 153, 0.15)', border: 'rgba(52, 211, 153, 0.3)', color: '#34d399', badgeBg: 'rgba(52, 211, 153, 0.2)' },
        { bg: 'rgba(129, 140, 248, 0.15)', border: 'rgba(129, 140, 248, 0.3)', color: '#818cf8', badgeBg: 'rgba(129, 140, 248, 0.2)' },
        { bg: 'rgba(251, 191, 36, 0.15)', border: 'rgba(251, 191, 36, 0.3)', color: '#fbbf24', badgeBg: 'rgba(251, 191, 36, 0.2)' },
        { bg: 'rgba(248, 113, 113, 0.15)', border: 'rgba(248, 113, 113, 0.3)', color: '#f87171', badgeBg: 'rgba(248, 113, 113, 0.2)' },
        { bg: 'rgba(217, 70, 239, 0.15)', border: 'rgba(217, 70, 239, 0.3)', color: '#d946ef', badgeBg: 'rgba(217, 70, 239, 0.2)' },
        { bg: 'rgba(56, 189, 248, 0.15)', border: 'rgba(56, 189, 248, 0.3)', color: '#38bdf8', badgeBg: 'rgba(56, 189, 248, 0.2)' },
    ];

    let teams = [];         // [{ name, score, members: [] }, ...]
    let currentTeamIdx = 0;
    let teamCount = 2;

    let timerDuration = 60;
    let winScore = 25;
    let timerInterval = null;
    let timeLeft = 60;

    let shuffledWords = [];
    let wordIndex = 0;
    let roundCorrect = 0;
    let roundSkipped = 0;
    let roundWords = [];

    /* --- Spelarinmatning --- */
    let playerCount = 0;

    function initPlayerInputs() {
        const container = document.getElementById('playerInputs');
        container.innerHTML = '';
        playerCount = 0;
        for (let i = 0; i < 4; i++) addPlayerInput();
    }

    function addPlayerInput() {
        playerCount++;
        const container = document.getElementById('playerInputs');
        const row = document.createElement('div');
        row.className = 'player-input-row';
        row.id = 'player-row-' + playerCount;
        row.innerHTML = `<input type="text" placeholder="Spelare ${playerCount}" data-player="true">` +
            `<button class="remove-btn" onclick="removePlayerInput('player-row-${playerCount}')">&times;</button>`;
        container.appendChild(row);
    }

    function removePlayerInput(rowId) {
        const row = document.getElementById(rowId);
        if (row) row.remove();
    }

    function changeTeamCount(delta) {
        teamCount = Math.max(2, Math.min(6, teamCount + delta));
        document.getElementById('teamCountDisplay').textContent = teamCount;
    }

    function getPlayerNames() {
        const inputs = document.querySelectorAll('#playerInputs input[data-player]');
        const names = [];
        inputs.forEach(inp => {
            const v = inp.value.trim();
            if (v) names.push(v);
        });
        return names;
    }

    function assignTeams() {
        const names = getPlayerNames();
        const errEl = document.getElementById('playerError');

        if (names.length < teamCount * 2) {
            errEl.textContent = `Det beh√∂vs minst ${teamCount * 2} spelare f√∂r ${teamCount} lag (minst 2 per lag).`;
            errEl.style.display = 'block';
            return;
        }
        errEl.style.display = 'none';

        // Shuffle players
        const shuffled = [...names].sort(() => Math.random() - 0.5);

        // Create teams
        teams = [];
        for (let i = 0; i < teamCount; i++) {
            teams.push({ name: `Lag ${i + 1}`, score: 0, members: [] });
        }

        // Distribute round-robin
        shuffled.forEach((name, idx) => {
            teams[idx % teamCount].members.push(name);
        });

        // Show team assignments
        showTeamAssignments();
        switchScreen('scr-players', 'scr-teams');
    }

    function showTeamAssignments() {
        const container = document.getElementById('teamAssignments');
        container.innerHTML = teams.map((team, i) => {
            const c = teamColors[i % teamColors.length];
            return `<div class="team-assignment" style="border-color: ${c.border};">
                <h3 style="color: ${c.color};">
                    <input type="text" value="${team.name}" onchange="teams[${i}].name = this.value"
                        style="background: transparent; border: none; color: ${c.color}; font-weight: 700;
                        font-size: 1.1rem; font-family: 'Outfit', sans-serif; padding: 0; width: 100%; text-align: center;">
                </h3>
                ${team.members.map(m => `<div class="member">${m}</div>`).join('')}
            </div>`;
        }).join('');
    }

    /* --- Spelstart --- */
    function startGame() {
        timerDuration = parseInt(document.getElementById('timerInput').value) || 60;
        winScore = parseInt(document.getElementById('winScoreInput').value) || 25;

        // Read any updated team names from inputs
        const nameInputs = document.querySelectorAll('#teamAssignments input[type="text"]');
        nameInputs.forEach((inp, i) => {
            if (teams[i]) teams[i].name = inp.value || `Lag ${i + 1}`;
        });

        // Reset scores
        teams.forEach(t => t.score = 0);

        // Shuffle words
        shuffledWords = [...allWords].sort(() => Math.random() - 0.5);
        wordIndex = 0;

        currentTeamIdx = 0;
        showTurnScreen();
    }

    function showTurnScreen() {
        updateAllScores();
        const badge = document.getElementById('turnTeamBadge');
        const c = teamColors[currentTeamIdx % teamColors.length];
        badge.textContent = teams[currentTeamIdx].name;
        badge.style.background = c.badgeBg;
        badge.style.color = c.color;
        switchScreen(activeScreen(), 'scr-turn');
    }

    function startTimer() {
        roundCorrect = 0;
        roundSkipped = 0;
        roundWords = [];
        timeLeft = timerDuration;

        showNextWord();
        updateTimerDisplay();
        switchScreen('scr-turn', 'scr-play');

        timerInterval = setInterval(() => {
            timeLeft--;
            updateTimerDisplay();
            if (timeLeft <= 0) {
                clearInterval(timerInterval);
                endRound();
            }
        }, 1000);
    }

    function updateTimerDisplay() {
        const el = document.getElementById('timerText');
        const bar = document.getElementById('timerBar');
        el.textContent = timeLeft;
        const pct = (timeLeft / timerDuration) * 100;
        bar.style.width = pct + '%';

        if (timeLeft <= 10) {
            el.className = 'timer-text warning';
            bar.className = 'timer-bar warning';
        } else {
            el.className = 'timer-text';
            bar.className = 'timer-bar';
        }
    }

    function showNextWord() {
        if (wordIndex >= shuffledWords.length) {
            shuffledWords = [...allWords].sort(() => Math.random() - 0.5);
            wordIndex = 0;
        }
        document.getElementById('wordDisplay').textContent = shuffledWords[wordIndex];
        document.getElementById('wordCounter').textContent = `Ord ${roundCorrect + roundSkipped + 1}`;
    }

    function correctWord() {
        roundWords.push({ word: shuffledWords[wordIndex], result: 'correct' });
        roundCorrect++;
        teams[currentTeamIdx].score++;
        wordIndex++;
        showNextWord();
    }

    function skipWord() {
        roundWords.push({ word: shuffledWords[wordIndex], result: 'skipped' });
        roundSkipped++;
        teams[currentTeamIdx].score = Math.max(0, teams[currentTeamIdx].score - 1);
        wordIndex++;
        showNextWord();
    }

    function endRound() {
        clearInterval(timerInterval);
        updateAllScores();

        const team = teams[currentTeamIdx];
        const net = roundCorrect - roundSkipped;
        document.getElementById('resultSummary').innerHTML =
            `<b>${team.name}</b> fick <b style="color:var(--accent)">${roundCorrect} r√§tt</b>` +
            (roundSkipped > 0 ? ` och hoppade √∂ver <b style="color:var(--danger)">${roundSkipped}</b>` : '') +
            ` (${net >= 0 ? '+' : ''}${net} netto)`;

        const wordsDiv = document.getElementById('resultWords');
        wordsDiv.innerHTML = roundWords.map(w =>
            `<div style="display:flex; justify-content:space-between; padding:8px 12px; border-radius:10px; margin-bottom:4px; background: ${w.result === 'correct' ? 'rgba(52,211,153,0.1)' : 'rgba(248,113,113,0.1)'}">
                <span>${w.word}</span>
                <span style="color:${w.result === 'correct' ? 'var(--accent)' : 'var(--danger)'}; font-weight:700;">${w.result === 'correct' ? '+1' : '-1'}</span>
            </div>`
        ).join('');

        // Check winner
        const hasWinner = teams.some(t => t.score >= winScore);
        if (hasWinner) {
            document.getElementById('btnNextRound').textContent = 'Se vinnaren!';
            document.getElementById('btnNextRound').onclick = showWinner;
        } else {
            document.getElementById('btnNextRound').textContent = 'N√§sta lag';
            document.getElementById('btnNextRound').onclick = nextTurn;
        }

        switchScreen('scr-play', 'scr-result');
    }

    function nextTurn() {
        currentTeamIdx = (currentTeamIdx + 1) % teams.length;
        showTurnScreen();
    }

    function showWinner() {
        const winner = teams.reduce((best, t) => t.score > best.score ? t : best, teams[0]);
        document.getElementById('winnerName').textContent = winner.name;
        document.getElementById('winnerSub').textContent = `vinner med ${winner.score} po√§ng!`;
        updateAllScores();
        switchScreen('scr-result', 'scr-final');
    }

    function renderScoreCards(containerId) {
        const el = document.getElementById(containerId);
        el.innerHTML = teams.map((team, i) => {
            const c = teamColors[i % teamColors.length];
            return `<div class="team-score-card" style="background: ${c.bg}; border: 1px solid ${c.border};">
                <div class="team-label">${team.name}</div>
                <div class="team-pts" style="color: ${c.color};">${team.score}</div>
            </div>`;
        }).join('');
    }

    function updateAllScores() {
        renderScoreCards('turnScores');
        renderScoreCards('resScores');
        renderScoreCards('finalScores');
    }

    /* Sk√§rmhantering */
    function switchScreen(from, to) {
        document.getElementById(from).classList.add('hidden');
        const next = document.getElementById(to);
        next.classList.remove('hidden');
        next.classList.remove('screen-animate');
        void next.offsetWidth;
        next.classList.add('screen-animate');
    }

    function activeScreen() {
        const ids = ['scr-start','scr-setup','scr-players','scr-teams','scr-turn','scr-play','scr-result','scr-final'];
        for (let id of ids) if (!document.getElementById(id).classList.contains('hidden')) return id;
        return 'scr-start';
    }

    // Initialize player inputs when page loads
    initPlayerInputs();
</script>
</body>
</html>
