<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Med andra ord ‚Äì Trekamp</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">

    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#0f172a">

    <style>
        :root {
            --bg-overlay: rgba(15, 23, 42, 0.85);
            --card: rgba(30, 41, 59, 0.8);
            --primary: #818cf8;
            --accent: #34d399;
            --winner-gold: #fbbf24;
            --text: #f8fafc;
            --glass: rgba(255, 255, 255, 0.05);
            --danger: #f87171;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Outfit', sans-serif;
            background-color: #0f172a;
            background-image: linear-gradient(var(--bg-overlay), var(--bg-overlay)), url('background2.png');
            background-size: cover;
            background-position: center center;
            background-attachment: fixed;
            color: var(--text);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            width: 95%;
            max-width: 500px;
            background: var(--card);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            padding: 40px 30px;
            border-radius: 32px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            text-align: center;
            opacity: 0;
            animation: startFadeIn 1s ease-out forwards;
            animation-delay: 0.3s;
        }

        @keyframes startFadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h1 { font-weight: 800; font-size: 2.5rem; margin: 0 0 10px; background: linear-gradient(to right, var(--primary), var(--accent)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        p { color: #94a3b8; margin-bottom: 20px; }

        .btn {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white; border: none; padding: 18px; border-radius: 18px;
            font-weight: 700; cursor: pointer; width: 100%; font-size: 1.1rem;
            margin-top: 15px; box-shadow: 0 10px 20px -5px rgba(129, 140, 248, 0.4);
            transition: all 0.3s ease; font-family: 'Outfit', sans-serif;
        }
        .btn:active { transform: scale(0.98); }

        .btn-secondary { background: var(--glass); border: 1px solid rgba(255,255,255,0.15); box-shadow: none; }

        /* Team selection */
        .team-choice {
            display: flex; gap: 15px; justify-content: center; margin: 25px 0;
        }

        .team-choice-btn {
            flex: 1; padding: 25px 15px; border-radius: 20px;
            border: 2px solid rgba(255,255,255,0.15); background: var(--glass);
            cursor: pointer; text-align: center; transition: all 0.3s ease;
            font-family: 'Outfit', sans-serif; color: var(--text);
        }

        .team-choice-btn:hover, .team-choice-btn.selected {
            border-color: var(--accent); background: rgba(52, 211, 153, 0.15);
        }

        .team-choice-btn .tc-num { font-size: 2.5rem; font-weight: 800; display: block; color: var(--accent); }
        .team-choice-btn .tc-label { font-size: 0.9rem; color: #94a3b8; margin-top: 4px; }

        /* Team assignment */
        .team-block {
            background: rgba(255,255,255,0.05); border-radius: 18px;
            padding: 15px; margin-bottom: 12px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .team-block h3 { font-size: 1.05rem; margin-bottom: 10px; }

        .team-member {
            display: flex; align-items: center; gap: 8px;
            padding: 5px 0;
        }
        .team-member img {
            width: 36px; height: 36px; border-radius: 50%; object-fit: cover;
        }
        .team-member span { font-weight: 600; font-size: 0.9rem; }

        /* Settings */
        .settings-row {
            display: flex; align-items: center; justify-content: space-between;
            background: rgba(255,255,255,0.05); padding: 14px 18px;
            border-radius: 14px; margin-top: 10px;
        }
        .settings-row label { font-weight: 600; font-size: 0.95rem; }
        .settings-row input {
            width: 80px; margin: 0; padding: 10px; font-size: 1rem;
            background: rgba(15, 23, 42, 0.8); border: 1px solid #334155;
            color: white; border-radius: 14px; text-align: center;
            font-family: 'Outfit', sans-serif;
        }

        /* Team score cards */
        .team-score-display { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .team-score-card {
            flex: 1 1 calc(50% - 10px); min-width: 80px; padding: 12px 8px;
            border-radius: 18px; text-align: center;
        }
        .team-score-card .team-label { font-size: 0.8rem; color: #94a3b8; margin-bottom: 4px; }
        .team-score-card .team-pts { font-size: 1.8rem; font-weight: 800; }

        /* Team faces during turn */
        .turn-faces {
            display: flex; justify-content: center; gap: 8px; margin: 15px 0;
        }
        .turn-faces img {
            width: 50px; height: 50px; border-radius: 50%; object-fit: cover;
            border: 2px solid rgba(255,255,255,0.2);
        }

        .team-indicator {
            display: inline-block; padding: 6px 16px; border-radius: 20px;
            font-weight: 700; font-size: 0.9rem; margin-bottom: 15px;
        }

        /* Word display */
        .word-display {
            background: rgba(15, 23, 42, 0.6); padding: 40px 25px; border-radius: 24px;
            border: 2px solid var(--accent); font-size: 2.2rem; font-weight: 800;
            margin: 25px 0; color: white; line-height: 1.3; min-height: 120px;
            display: flex; align-items: center; justify-content: center; user-select: none;
        }

        /* Timer */
        .timer-container { margin: 20px 0; }
        .timer-bar-bg { width: 100%; height: 12px; background: rgba(255,255,255,0.1); border-radius: 6px; overflow: hidden; }
        .timer-bar { height: 100%; background: linear-gradient(90deg, var(--accent), var(--primary)); border-radius: 6px; transition: width 0.1s linear; width: 100%; }
        .timer-bar.warning { background: linear-gradient(90deg, var(--danger), #fbbf24); }
        .timer-text { font-size: 2rem; font-weight: 800; margin-bottom: 8px; color: var(--accent); }
        .timer-text.warning { color: var(--danger); }

        .word-counter { color: #64748b; font-size: 0.85rem; margin-top: 5px; }

        .round-controls { display: flex; gap: 12px; margin-top: 15px; }
        .round-controls .btn { flex: 1; margin-top: 0; }

        /* Result faces */
        .result-faces {
            display: flex; justify-content: center; gap: 8px; margin: 15px 0;
        }
        .result-faces img {
            width: 46px; height: 46px; border-radius: 50%; object-fit: cover;
            transition: all 0.4s ease;
        }
        .result-faces img.happy { animation: happyBounce 0.5s ease; }
        @keyframes happyBounce { 0% { transform: scale(1); } 40% { transform: scale(1.25); } 100% { transform: scale(1); } }

        /* Winner */
        .winner-crown { font-size: 4rem; margin-bottom: 10px; animation: bounce 1s infinite; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

        .winner-faces {
            display: flex; justify-content: center; gap: 10px; margin: 15px 0;
        }
        .winner-faces img {
            width: 70px; height: 70px; border-radius: 50%; object-fit: cover;
            border: 3px solid var(--winner-gold);
            box-shadow: 0 0 15px rgba(251,191,36,0.4);
            animation: bounce 1.5s ease-in-out infinite;
        }

        .hidden { display: none !important; }
        .screen-animate { animation: fadeIn 0.4s forwards ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* Confetti */
        .confetti-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1000; overflow: hidden; }
        .confetti { position: absolute; width: 10px; height: 10px; top: -10px; animation: confettiFall linear forwards; }
        @keyframes confettiFall { 0% { transform: translateY(0) rotate(0deg); opacity: 1; } 100% { transform: translateY(100vh) rotate(720deg); opacity: 0; } }
    </style>
</head>
<body>

<div class="container" id="app">

    <!-- TEAM CHOICE -->
    <div id="scr-teamchoice" class="screen-animate">
        <div style="font-size: 3.5rem; margin-bottom: 15px;">üí¨</div>
        <h1>Med andra ord</h1>
        <p>F√∂rklara ord f√∂r ditt lag utan att s√§ga sj√§lva ordet!</p>
        <p style="font-weight: 700; color: var(--text);">Hur m√•nga lag vill ni spela i?</p>
        <div class="team-choice">
            <button class="team-choice-btn" onclick="chooseTeams(2)">
                <span class="tc-num">2</span>
                <span class="tc-label">Tv√• lag (4+4)</span>
            </button>
            <button class="team-choice-btn" onclick="chooseTeams(4)">
                <span class="tc-num">4</span>
                <span class="tc-label">Fyra lag (2+2+2+2)</span>
            </button>
        </div>
        <div class="settings-row">
            <label>Sekunder per runda:</label>
            <input type="number" id="timerInput" value="60" min="20" max="120" step="10">
        </div>
        <div class="settings-row" style="margin-top: 8px;">
            <label>Po√§ng f√∂r att vinna:</label>
            <input type="number" id="winScoreInput" value="25" min="5" max="100" step="5">
        </div>
        <a href="index.html" style="display:inline-block; margin-top:20px; color:#818cf8; font-size:0.9rem; text-decoration:none;">&#8592; Tillbaka till trekampen</a>
    </div>

    <!-- TEAM DISPLAY -->
    <div id="scr-teams" class="hidden screen-animate">
        <h1>Lagen!</h1>
        <p>S√• h√§r slumpades lagen!</p>
        <div id="teamAssignments"></div>
        <button class="btn" onclick="startGame()">Starta spelet!</button>
        <button class="btn btn-secondary" onclick="reshuffleTeams()" style="margin-top: 8px;">Slumpa om</button>
    </div>

    <!-- TURN SCREEN -->
    <div id="scr-turn" class="hidden screen-animate">
        <div class="team-score-display" id="turnScores"></div>
        <div id="turnTeamBadge" class="team-indicator">Lag</div>
        <h1 style="font-size: 1.8rem; margin-bottom: 5px;">Er tur att f√∂rklara!</h1>
        <div class="turn-faces" id="turnFaces"></div>
        <p>Ge telefonen till den som ska f√∂rklara</p>
        <button class="btn" onclick="startTimer()">Starta rundan!</button>
    </div>

    <!-- PLAY SCREEN -->
    <div id="scr-play" class="hidden screen-animate">
        <div class="timer-container">
            <div class="timer-text" id="timerText">60</div>
            <div class="timer-bar-bg"><div class="timer-bar" id="timerBar"></div></div>
        </div>
        <div class="word-display" id="wordDisplay">‚Äî</div>
        <div class="word-counter" id="wordCounter">Ord 1</div>
        <div class="round-controls">
            <button class="btn btn-secondary" onclick="skipWord()" style="background: rgba(248,113,113,0.2); border-color: rgba(248,113,113,0.4); color: var(--danger);">Hoppa √∂ver (-1)</button>
            <button class="btn" onclick="correctWord()">R√§tt! (+1)</button>
        </div>
    </div>

    <!-- RESULT SCREEN -->
    <div id="scr-result" class="hidden screen-animate">
        <h1 style="font-size: 1.8rem;">Rundan slut!</h1>
        <div class="team-score-display" id="resScores" style="margin-top: 20px;"></div>
        <div class="result-faces" id="resultFaces"></div>
        <p id="resultSummary" style="font-size: 1.1rem; color: var(--text);"></p>
        <div id="resultWords" style="margin: 15px 0; text-align: left;"></div>
        <button class="btn" id="btnNextRound" onclick="nextTurn()">N√§sta lag</button>
    </div>

    <!-- WINNER SCREEN -->
    <div id="scr-final" class="hidden screen-animate">
        <div class="winner-crown">üëë</div>
        <h1 id="winnerName" style="font-size: 2.5rem; color: var(--winner-gold); -webkit-text-fill-color: var(--winner-gold);">Vinnare!</h1>
        <div class="winner-faces" id="winnerFaces"></div>
        <p id="winnerSub" style="font-size: 1.1rem;">vinner med 25 po√§ng!</p>
        <div class="team-score-display" id="finalScores" style="margin-top: 20px;"></div>
        <button class="btn" onclick="saveAndReturn()">Tillbaka till trekampen</button>
    </div>
</div>

<div class="confetti-container" id="confettiContainer"></div>

<script>
    const PLAYERS = [
        { name: 'Jonas', img: 'Jonas' },
        { name: 'Jessica', img: 'Jessan' },
        { name: 'Johanna', img: 'Johanna' },
        { name: 'Alex', img: 'Alex' },
        { name: 'Rasmus', img: 'Rasmus' },
        { name: 'Boel', img: 'Boel' },
        { name: 'Karla', img: 'Karla' },
        { name: 'Elin', img: 'Elin' }
    ];

    function getImg(p, mood) {
        return 'Chameleon Lillebror/' + mood + ' ' + p.img + '.webp';
    }

    const allWords = [
        "Tandborste","Flygplan","Jordgubbe","Solglas√∂gon","Regnb√•ge",
        "Fotboll","Dammsugare","Skorsten","H√§ngmatta","Fallsk√§rm",
        "Segelb√•t","Karusell","Glasspinne","Brevl√•da","Trumma",
        "Popcorn","Pyramid","Dagbok","Cykel","Studsare",
        "Strykj√§rn","Ambulans","Kikare","Ryggs√§ck","Solros",
        "Ficklampa","Helikopter","Vulkan","Skateboard","Gardin",
        "Diskmaskin","St√∂vlar","Paraply","Bergochdalbana","Kompass",
        "Akvarium","Saxofon","H√∂rlurar","Kamera","Sm√∂rg√•s",
        "Badkar","Vindkraftverk","Skottk√§rra","Dykare","Smink",
        "Grillkorv","Studentm√∂ssa","Dockhus","Trampolin","Palmtr√§d",
        "T√§lt","Ballong","Gungstol","Tennisracket","Roddb√•t",
        "Sn√∂gubbe","Spindeln√§t","Eldslukare","F√•gelskr√§mma","Flaskhals",
        "Korsord","Sandslott","Fiskm√•s","Vattenpistol","Myra",
        "Pingvin","K√§nguru","Delfin","Uggla","Papegoja",
        "Elefant","Krokodil","Sk√∂ldpadda","Giraff","Flodh√§st",
        "Astronaut","Brandman","Sjuksk√∂terska","Bagare","Fris√∂r",
        "Pilot","Clown","Detektiv","Cowboy","Trollkarl",
        "Pannkaka","Kanelbulle","K√∂ttbullar","Varmkorv","Chokladkaka",
        "Kaffekopp","Potatisskalare","Br√∂drost","Tv√§ttmaskin","Kylsk√•p",
        "Fyrtorn","Igloo","Slott","Vindm√∂lla","Font√§n",
        "Rulltrappa","Bilbarnstol","Dr√∂nare","S√•pbubbla","Torktumlare",
        "Vattenfall","Laviner","Gl√∂dlampa","Diamant","Skattkista",
        "Mustasch","Peruk","Megafon","Rullstol","Gosedjur",
        "Skratta","Simma","Jonglera","Vissla","Snickra",
        "G√§spa","Kl√§ttra","Brottas","Dansa","Dr√∂mma",
        "Snubbla","Krypa","Grilla","Hosta","Jogga",
        "Steka","H√§nga","Blunda","Smyga","Snarka",
        "Paddla","Segla","Dyka","Surfa","Hoppa",
        "Nicka","Blinka","Sjunga","Sova","M√•la",
        "Gr√•ta","Baka","Meditera","Dirigera","T√§vla",
        "Flyga","Ramla","Nyna","Sparka","Snurra",
        "Trolla","Buga","Flirta","Stretcha","Pussla",
        "Skala","Fiska","Jaga","Springa","Skida",
        "Modig","Avundsjuk","Generad","Envis","Mystisk",
        "Klurig","Nyfiken","Blyg","Girig","Listig",
        "H√§ftig","Klumpig","Lat","R√§dd","Stolt",
        "F√∂rvirrad","L√∂jlig","√ñdmjuk","Artig","Elak",
        "Vresig","Romantisk","Nostalgisk","Spontan","Lycklig",
        "Besviken","F√∂r√§lskad","Hungrig","T√∂rstig","Tr√∂tt",
        "Frusen","Svettig","Yr","Gener√∂s","Dramatisk",
        "Nostalgi","Frihet","Fantasi","R√§ttvisa","V√§nskap",
        "Karma","Kaos","Instinkt","Tradition","Kreativitet",
        "Stolthet","Empati","Mod","Tur","√ñde",
        "Samvete","K√§rlek","Avund","Makt","Hopp",
        "Gl√§dje","Sorg","Ilska","Respekt","Lojalitet",
        "√Ñventyr","Ensamhet","Panik","L√§ngtan","Inspiration",
        "Harmoni","Karisma","Disciplin","Ironi","T√•lamod",
        "Demokrati","Paradox","Filosofi","Kompromiss","Revolution",
        "Perspektiv","Melankoli","Eufori","Metafor","Symbolik",
        "Trov√§rdighet","Sj√§lvf√∂rtroende","Integritet","Manipulera","Imponera",
        "Provocera","√ñvertyga","√ñverskatta","Underskatta","Ifr√•gas√§tta",
        "Stereotyp","Grupptryck","Skadegl√§dje","Rampfeber",
        "Pippi L√•ngstrump","Einstein","Kleopatra","Bamse","Zlatan",
        "Harry Potter","Batman","Tarzan","Musse Pigg","R√∂dluvan",
        "Elvis","Madonna","Mona Lisa","Astrid Lindgren","Robin Hood",
        "Donald Duck","Sherlock Holmes","Mozart","Napoleon","ABBA",
        "Karlsson p√• taket","Ronja R√∂vardotter","Emil i L√∂nneberga","Nalle Puh","Pinocchio",
        "Dracula","Sn√∂vit","Askungen","Zorro","Greta Thunberg",
        "Shrek","Elsa fr√•n Frost","Yoda","James Bond","Indiana Jones",
        "Mario","SpongeBob","Simba","Buzz Lightyear",
        "Hermione Granger","Gandalf","Darth Vader","Spider-Man","Wonder Woman",
        "Kalle Anka","Alfons √Öberg","Pettson och Findus","Mumin"
    ];

    const teamColors = [
        { bg: 'rgba(52, 211, 153, 0.15)', border: 'rgba(52, 211, 153, 0.3)', color: '#34d399', badgeBg: 'rgba(52, 211, 153, 0.2)' },
        { bg: 'rgba(129, 140, 248, 0.15)', border: 'rgba(129, 140, 248, 0.3)', color: '#818cf8', badgeBg: 'rgba(129, 140, 248, 0.2)' },
        { bg: 'rgba(251, 191, 36, 0.15)', border: 'rgba(251, 191, 36, 0.3)', color: '#fbbf24', badgeBg: 'rgba(251, 191, 36, 0.2)' },
        { bg: 'rgba(248, 113, 113, 0.15)', border: 'rgba(248, 113, 113, 0.3)', color: '#f87171', badgeBg: 'rgba(248, 113, 113, 0.2)' },
    ];

    let teams = [];
    let currentTeamIdx = 0;
    let teamCount = 2;

    let timerDuration = 60;
    let winScore = 25;
    let timerInterval = null;
    let timeLeft = 60;

    let shuffledWords = [];
    let wordIndex = 0;
    let roundCorrect = 0;
    let roundSkipped = 0;
    let roundWords = [];

    function chooseTeams(count) {
        teamCount = count;
        buildTeams();
        showTeamAssignments();
        switchScreen('scr-teamchoice', 'scr-teams');
    }

    function buildTeams() {
        const shuffled = [...PLAYERS].sort(() => Math.random() - 0.5);
        teams = [];
        for (let i = 0; i < teamCount; i++) {
            teams.push({ name: 'Lag ' + (i + 1), score: 0, members: [] });
        }
        shuffled.forEach((p, idx) => {
            teams[idx % teamCount].members.push(p);
        });
    }

    function reshuffleTeams() {
        buildTeams();
        showTeamAssignments();
    }

    function showTeamAssignments() {
        const container = document.getElementById('teamAssignments');
        container.innerHTML = teams.map((team, i) => {
            const c = teamColors[i % teamColors.length];
            return '<div class="team-block" style="border-color: ' + c.border + ';">' +
                '<h3 style="color: ' + c.color + ';">' + team.name + '</h3>' +
                team.members.map(m =>
                    '<div class="team-member">' +
                    '<img src="' + getImg(m, 'Rund') + '" alt="' + m.name + '">' +
                    '<span>' + m.name + '</span></div>'
                ).join('') +
                '</div>';
        }).join('');
    }

    function startGame() {
        timerDuration = parseInt(document.getElementById('timerInput').value) || 60;
        winScore = parseInt(document.getElementById('winScoreInput').value) || 25;

        teams.forEach(t => t.score = 0);
        shuffledWords = [...allWords].sort(() => Math.random() - 0.5);
        wordIndex = 0;
        currentTeamIdx = 0;
        showTurnScreen();
    }

    function showTurnScreen() {
        updateAllScores();
        const team = teams[currentTeamIdx];
        const c = teamColors[currentTeamIdx % teamColors.length];
        const badge = document.getElementById('turnTeamBadge');
        badge.textContent = team.name;
        badge.style.background = c.badgeBg;
        badge.style.color = c.color;

        // Show team member faces
        document.getElementById('turnFaces').innerHTML = team.members.map(m =>
            '<img src="' + getImg(m, 'Rund') + '" alt="' + m.name + '" title="' + m.name + '">'
        ).join('');

        switchScreen(activeScreen(), 'scr-turn');
    }

    function startTimer() {
        roundCorrect = 0;
        roundSkipped = 0;
        roundWords = [];
        timeLeft = timerDuration;

        showNextWord();
        updateTimerDisplay();
        switchScreen('scr-turn', 'scr-play');

        timerInterval = setInterval(() => {
            timeLeft--;
            updateTimerDisplay();
            if (timeLeft <= 0) {
                clearInterval(timerInterval);
                endRound();
            }
        }, 1000);
    }

    function updateTimerDisplay() {
        const el = document.getElementById('timerText');
        const bar = document.getElementById('timerBar');
        el.textContent = timeLeft;
        const pct = (timeLeft / timerDuration) * 100;
        bar.style.width = pct + '%';
        if (timeLeft <= 10) {
            el.className = 'timer-text warning';
            bar.className = 'timer-bar warning';
        } else {
            el.className = 'timer-text';
            bar.className = 'timer-bar';
        }
    }

    function showNextWord() {
        if (wordIndex >= shuffledWords.length) {
            shuffledWords = [...allWords].sort(() => Math.random() - 0.5);
            wordIndex = 0;
        }
        document.getElementById('wordDisplay').textContent = shuffledWords[wordIndex];
        document.getElementById('wordCounter').textContent = 'Ord ' + (roundCorrect + roundSkipped + 1);
    }

    function correctWord() {
        roundWords.push({ word: shuffledWords[wordIndex], result: 'correct' });
        roundCorrect++;
        teams[currentTeamIdx].score++;
        wordIndex++;
        showNextWord();
    }

    function skipWord() {
        roundWords.push({ word: shuffledWords[wordIndex], result: 'skipped' });
        roundSkipped++;
        teams[currentTeamIdx].score = Math.max(0, teams[currentTeamIdx].score - 1);
        wordIndex++;
        showNextWord();
    }

    function endRound() {
        clearInterval(timerInterval);
        updateAllScores();

        const team = teams[currentTeamIdx];
        const net = roundCorrect - roundSkipped;

        // Show team faces reacting
        const mood = net > 0 ? 'Glad' : (net < 0 ? 'Ledsen' : 'Rund');
        document.getElementById('resultFaces').innerHTML = team.members.map(m =>
            '<img class="' + (net > 0 ? 'happy' : '') + '" src="' + getImg(m, mood) + '" alt="' + m.name + '">'
        ).join('');

        document.getElementById('resultSummary').innerHTML =
            '<b>' + team.name + '</b> fick <b style="color:var(--accent)">' + roundCorrect + ' r√§tt</b>' +
            (roundSkipped > 0 ? ' och hoppade √∂ver <b style="color:var(--danger)">' + roundSkipped + '</b>' : '') +
            ' (' + (net >= 0 ? '+' : '') + net + ' netto)';

        document.getElementById('resultWords').innerHTML = roundWords.map(w =>
            '<div style="display:flex; justify-content:space-between; padding:8px 12px; border-radius:10px; margin-bottom:4px; background: ' +
            (w.result === 'correct' ? 'rgba(52,211,153,0.1)' : 'rgba(248,113,113,0.1)') + '">' +
            '<span>' + w.word + '</span>' +
            '<span style="color:' + (w.result === 'correct' ? 'var(--accent)' : 'var(--danger)') +
            '; font-weight:700;">' + (w.result === 'correct' ? '+1' : '-1') + '</span></div>'
        ).join('');

        const hasWinner = teams.some(t => t.score >= winScore);
        const btn = document.getElementById('btnNextRound');
        if (hasWinner) {
            btn.textContent = 'Se vinnaren!';
            btn.onclick = showWinner;
        } else {
            btn.textContent = 'N√§sta lag';
            btn.onclick = nextTurn;
        }

        switchScreen('scr-play', 'scr-result');
    }

    function nextTurn() {
        currentTeamIdx = (currentTeamIdx + 1) % teams.length;
        showTurnScreen();
    }

    function showWinner() {
        const winner = teams.reduce((best, t) => t.score > best.score ? t : best, teams[0]);
        document.getElementById('winnerName').textContent = winner.name;
        document.getElementById('winnerSub').textContent = 'vinner med ' + winner.score + ' po√§ng!';

        // Show winner team faces (Glad)
        document.getElementById('winnerFaces').innerHTML = winner.members.map(m =>
            '<img src="' + getImg(m, 'Glad') + '" alt="' + m.name + '" title="' + m.name + '">'
        ).join('');

        updateAllScores();
        switchScreen('scr-result', 'scr-final');
        launchConfetti();
    }

    function saveAndReturn() {
        try {
            // Distribute team scores to individual players
            const scores = JSON.parse(localStorage.getItem('trekamp_scores') || '{}');
            teams.forEach(team => {
                team.members.forEach(m => {
                    scores[m.name] = (scores[m.name] || 0) + team.score;
                });
            });
            localStorage.setItem('trekamp_scores', JSON.stringify(scores));

            const games = JSON.parse(localStorage.getItem('trekamp_games') || '[]');
            if (!games.includes('med-andra-ord')) games.push('med-andra-ord');
            localStorage.setItem('trekamp_games', JSON.stringify(games));
        } catch(e) {}

        window.location.href = 'index.html';
    }

    function renderScoreCards(containerId) {
        const el = document.getElementById(containerId);
        el.innerHTML = teams.map((team, i) => {
            const c = teamColors[i % teamColors.length];
            return '<div class="team-score-card" style="background: ' + c.bg + '; border: 1px solid ' + c.border + ';">' +
                '<div class="team-label">' + team.name + '</div>' +
                '<div class="team-pts" style="color: ' + c.color + ';">' + team.score + '</div></div>';
        }).join('');
    }

    function updateAllScores() {
        renderScoreCards('turnScores');
        renderScoreCards('resScores');
        renderScoreCards('finalScores');
    }

    function switchScreen(from, to) {
        document.getElementById(from).classList.add('hidden');
        const next = document.getElementById(to);
        next.classList.remove('hidden');
        next.classList.remove('screen-animate');
        void next.offsetWidth;
        next.classList.add('screen-animate');
    }

    function activeScreen() {
        const ids = ['scr-teamchoice','scr-teams','scr-turn','scr-play','scr-result','scr-final'];
        for (let id of ids) if (!document.getElementById(id).classList.contains('hidden')) return id;
        return 'scr-teamchoice';
    }

    function launchConfetti() {
        const container = document.getElementById('confettiContainer');
        const colors = ['#818cf8', '#34d399', '#fbbf24', '#d946ef', '#f472b6', '#38bdf8'];
        for (let i = 0; i < 60; i++) {
            const el = document.createElement('div');
            el.className = 'confetti';
            el.style.left = Math.random() * 100 + '%';
            el.style.background = colors[Math.floor(Math.random() * colors.length)];
            el.style.width = (6 + Math.random() * 8) + 'px';
            el.style.height = (6 + Math.random() * 8) + 'px';
            el.style.borderRadius = Math.random() > 0.5 ? '50%' : '2px';
            el.style.animationDuration = (2 + Math.random() * 3) + 's';
            el.style.animationDelay = (Math.random() * 2) + 's';
            container.appendChild(el);
        }
        setTimeout(() => { container.innerHTML = ''; }, 6000);
    }
</script>
</body>
</html>
